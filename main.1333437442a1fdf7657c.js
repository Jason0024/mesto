!function(){"use strict";const e=document.querySelector(".popup_type_profile"),t=document.querySelector(".profile__edit"),s=e.querySelector(".popup__form"),i=s.querySelector("#name"),r=s.querySelector("#job"),n=document.querySelector(".popup_type_photo"),o=document.querySelector(".add-button"),a=n.querySelector(".popup__form"),l=document.querySelector(".popup_type_avatar").querySelector(".popup__form"),c=document.querySelector(".profile__avatar-btn"),h=document.querySelector(".profile__avatar"),_={inputSelector:".popup__input",submitButtonSelector:".popup__submit",inactiveButtonClass:"popup__submit_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__input-error_active"};class p{constructor(e,t){this._config=e,this._formElement=t,this._inactiveButtonClass=e.inactiveButtonClass,this._inputList=Array.from(this._formElement.querySelectorAll(this._config.inputSelector)),this._buttonElement=this._formElement.querySelector(this._config.submitButtonSelector)}_showInputError(e,t){const s=this._formElement.querySelector("#".concat(e.id,"-error"));e.classList.add(this._config.inputErrorClass),s.textContent=t,s.classList.add(this._config.errorClass)}_hideInputError(e){const t=this._formElement.querySelector("#".concat(e.id,"-error"));e.classList.remove(this._config.inputErrorClass),t.classList.remove(this._config.errorClass),t.textContent=""}_checkInputValidity(e){e.validity.valid?this._hideInputError(e):this._showInputError(e,e.validationMessage)}resetValidation(){this.toggleButtonState(),this._inputList.forEach((e=>{this._hideInputError(e)}))}_hasInvalidInput(){return this._inputList.some((e=>!e.validity.valid))}toggleButtonState(){this._hasInvalidInput()?(this._buttonElement.setAttribute("disabled",!0),this._buttonElement.classList.add(this._inactiveButtonClass)):(this._buttonElement.classList.remove(this._inactiveButtonClass),this._buttonElement.removeAttribute("disabled"))}_setEventListeners(){this.toggleButtonState(),this._inputList.forEach((e=>{e.addEventListener("input",(()=>{this._checkInputValidity(e),this.toggleButtonState()}))}))}enableValidation(){this._setEventListeners()}}class d{constructor(e){let{data:t,cardSelector:s,userId:i,handleCardClick:r,handleDeleteIconClick:n,api:o}=e;this._name=t.name,this._link=t.link,this._cardSelector=s,this._userId=i,this._cardId=t._id,this._cardOwnerId=t.owner._id,this._api=o,this._handleCardClick=r,this._handleDeleteIconClick=n,this._likes=t.likes}_getTemplate(){return this._card=document.querySelector(this._cardSelector).content.querySelector(".element-grid__item").cloneNode(!0),this._card}_setEventListeners(){this._image.addEventListener("click",(()=>{this._handleCardClick(this._name,this._link)})),this._deleteBtn.addEventListener("click",(()=>{this._handleDeleteIconClick(this._card,this._cardId)})),this._likeBtn.addEventListener("click",(()=>{this._handleLikeCard()}))}generateCard(){return this._element=this._getTemplate(),this._image=this._element.querySelector(".element-grid__pic"),this._likeBtn=this._element.querySelector(".element-grid__like"),this._likesNumber=this._element.querySelector(".element-grid__likes-number"),this._deleteBtn=this._element.querySelector(".element-grid__delete"),this._image.src=this._link,this._image.alt=this._name,this._element.querySelector(".element-grid__title").textContent=this._name,this._hasDeleteBtn(),this._isCardLiked(),this._likesNumber.textContent=this._likes.length,this._setEventListeners(),this._element}_isCardLiked(){this._likes.some((e=>this._userId===e._id))&&this._likeBtn.classList.add("element-grid__like_active")}_handleLikeCard(){this._likeBtn.classList.contains("element-grid__like_active")?this._api.deleteLike(this._cardId).then((e=>{this._likeBtn.classList.remove("element-grid__like_active"),this._likesNumber.textContent=e.likes.length})).catch((e=>{console.log("Ошибка: ".concat(e))})):this._api.setLike(this._cardId).then((e=>{this._likeBtn.classList.add("element-grid__like_active"),this._likesNumber.textContent=e.likes.length})).catch((e=>{console.log("Ошибка: ".concat(e))}))}_hasDeleteBtn(){this._userId!==this._cardOwnerId&&this._deleteBtn.remove()}}class u{constructor(e){this._popup=document.querySelector(e),this._closeButton=this._popup.querySelector(".popup__close"),this._escapeClose=this._handleEscClose.bind(this)}open(){this._popup.classList.add("popup_open"),document.addEventListener("keydown",this._escapeClose)}close(){this._popup.classList.remove("popup_open"),document.removeEventListener("keydown",this._escapeClose)}_handleEscClose(e){"Escape"===e.key&&this.close()}setEventListeners(){this._closeButton.addEventListener("click",(()=>{this.close()})),this._popup.addEventListener("mousedown",(e=>{e.target.classList.contains("popup")&&this.close()}))}}class m extends u{constructor(e){let{popupSelector:t,handleFormSubmit:s}=e;super(t),this._handleFormSubmit=s,this._popupForm=this._popup.querySelector(".popup__form"),this._inputList=this._popupForm.querySelectorAll(".popup__input"),this._submitBtn=this._popupForm.querySelector(".popup__submit"),this._submitBtnText=this._submitBtn.textContent}_getInputValues(){return this._formValues={},this._inputList.forEach((e=>{this._formValues[e.name]=e.value})),this._formValues}setEventListeners(){super.setEventListeners(),this._popupForm.addEventListener("submit",(e=>{e.preventDefault(),this._handleFormSubmit(this._getInputValues())}))}close(){super.close(),this._popupForm.reset()}loading(e){this._submitBtn.textContent=e?"Сохранение...":this._submitBtnText}}const v=new class{constructor(e){this._baseUrl=e.baseUrl,this._headers=e.headers}_parseResponse(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}getInitialCards(){return fetch("".concat(this._baseUrl,"/cards"),{headers:this._headers}).then((e=>this._parseResponse(e)))}addCard(e){return fetch("".concat(this._baseUrl,"/cards"),{method:"POST",headers:this._headers,body:JSON.stringify({name:e.name,link:e.link})}).then((e=>this._parseResponse(e)))}deleteCard(e){return fetch("".concat(this._baseUrl,"/cards/").concat(e),{method:"DELETE",headers:this._headers}).then((e=>this._parseResponse(e)))}setLike(e){return fetch("".concat(this._baseUrl,"/cards/").concat(e,"/likes"),{method:"PUT",headers:this._headers}).then((e=>this._parseResponse(e)))}deleteLike(e){return fetch("".concat(this._baseUrl,"/cards/").concat(e,"/likes"),{method:"DELETE",headers:this._headers}).then((e=>this._parseResponse(e)))}getUserInfo(){return fetch("".concat(this._baseUrl,"/users/me"),{headers:this._headers}).then((e=>this._parseResponse(e)))}editUserInfo(e){return fetch("".concat(this._baseUrl,"/users/me"),{method:"PATCH",headers:this._headers,body:JSON.stringify({name:e.username,about:e.job})}).then((e=>this._parseResponse(e)))}editAvatar(e){return fetch("".concat(this._baseUrl,"/users/me/avatar"),{method:"PATCH",headers:this._headers,body:JSON.stringify({avatar:e.avatar})}).then((e=>this._parseResponse(e)))}}({baseUrl:"https://mesto.nomoreparties.co/v1/cohort-46",headers:{authorization:"0ed17c22-f397-419f-ac16-14e0c634d00d","Content-Type":"application/json"}});let g;Promise.all([v.getInitialCards(),v.getUserInfo()]).then((e=>{let[t,s]=e;b.setUserInfo(s),g=s._id,C.renderItems(t)})).catch((e=>{console.log("Ошибка: ".concat(e))}));const b=new class{constructor(e){let{username:t,job:s,avatar:i,api:r}=e;this._username=document.querySelector(t),this._job=document.querySelector(s),this._avatar=document.querySelector(i),this._api=r}getUserInfo(){const e={};return e.username=this._username.textContent,e.job=this._job.textContent,e}setUserAvatar(e){let{avatar:t}=e;this._avatar.src=t}setUserInfo(e){this._username.textContent=e.name,this._job.textContent=e.about,this._avatar.src=e.avatar}setUserInfo(e){let{name:t,about:s,avatar:i,_id:r}=e;this._username.textContent=t,this._job.textContent=s,this.userId=r,this.setUserAvatar({avatar:i})}}({username:".profile__name",job:".profile__job",avatar:".profile__avatar",api:v}),f=new m({popupSelector:".popup_type_profile",handleFormSubmit:e=>{f.loading(!0),v.editUserInfo(e).then((e=>{b.setUserInfo(e),f.close()})).catch((e=>{console.log("Ошибка: ".concat(e))})).finally((()=>{f.loading(!1)}))}});f.setEventListeners();const S=new m({popupSelector:".popup_type_avatar",handleFormSubmit:e=>{S.loading(!0),v.editAvatar(e).then((e=>{h.src=e.avatar,S.close()})).catch((e=>{console.log("Ошибка: ".concat(e))})).finally((()=>{S.loading(!1)}))},api:v});S.setEventListeners(),c.addEventListener("click",(()=>{B.toggleButtonState(),B.resetValidation(),S.open()})),t.addEventListener("click",(()=>{I.resetValidation();const e=b.getUserInfo();!function(e){let{username:t,job:s}=e;i.value=t,r.value=s}({username:e.username,job:e.job}),f.open()}));const y=e=>new d({data:e,cardSelector:".element-grid-template",userId:g,handleCardClick:(e,t)=>{L.open(e,t)},handleDeleteIconClick:(e,t)=>{E.open(e,t)},api:v}).generateCard(),C=new class{constructor(e,t){let{renderer:s}=e;this._renderer=s,this._container=document.querySelector(t)}renderItems(e){e.reverse().forEach((e=>this._renderer(e)))}addItem(e){this._container.prepend(e)}}({renderer:e=>{C.addItem(y(e))}},".elements"),k=new m({popupSelector:".popup_type_photo",handleFormSubmit:e=>{k.loading(!0),v.addCard(e).then((e=>{C.addItem(y(e)),k.close()})).catch((e=>{console.log("Ошибка: ".concat(e))})).finally((()=>{k.loading(!1)}))}});k.setEventListeners(),o.addEventListener("click",(()=>{q.toggleButtonState(),q.resetValidation(),k.open()}));const E=new class extends u{constructor(e){let{popupSelector:t,handleDeleteCard:s}=e;super(t),this._handleDeleteCard=s,this._form=this._popup.querySelector(".popup__form")}open(e,t){this._card=e,this._cardId=t,super.open()}setEventListeners(){super.setEventListeners(),this._form.addEventListener("click",(e=>{e.preventDefault(),this._handleDeleteCard(this._card,this._cardId)}))}}({popupSelector:".popup_type_delete-card",handleDeleteCard:(e,t)=>{v.deleteCard(t).then((()=>{e.remove(),E.close()})).catch((e=>{console.log("Ошибка: ".concat(e))}))}});E.setEventListeners();const L=new class extends u{constructor(e){super(e),this._popupImage=this._popup.querySelector(".popup__pic"),this._popupName=this._popup.querySelector(".popup__caption")}open(e,t){super.open(),this._popupName.textContent=e,this._popupImage.src=t,this._popupImage.alt=e}}(".popup_type_modal");L.setEventListeners();const I=new p(_,s);I.enableValidation();const q=new p(_,a);q.enableValidation();const B=new p(_,l);B.enableValidation()}();